<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meme Maker - Bikin Meme Sendiri!</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useRef, useEffect } = React;
        const Upload = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>;
        const Download = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>;
        const Type = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9" y1="20" x2="15" y2="20"/><line x1="12" y1="4" x2="12" y2="20"/></svg>;
        const Trash2 = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/><line x1="10" y1="11" x2="10" y2="17"/><line x1="14" y1="11" x2="14" y2="17"/></svg>;
        const ImageIcon = () => <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>;

        const MemeMaker = () => {
            const [image, setImage] = useState(null);
            const [topText, setTopText] = useState('');
            const [bottomText, setBottomText] = useState('');
            const [fontSize, setFontSize] = useState(48);
            const [fontFamily, setFontFamily] = useState('Impact');
            const [uploadedFontName, setUploadedFontName] = useState('');
            const [outlineWidth, setOutlineWidth] = useState(3);
            const [topTextPos, setTopTextPos] = useState({ x: 0.5, y: 0.15 });
            const [bottomTextPos, setBottomTextPos] = useState({ x: 0.5, y: 0.85 });
            const [dragging, setDragging] = useState(null);
            const [riccoClicks, setRiccoClicks] = useState(0);
            const [isAnimating, setIsAnimating] = useState(false);
            const [stickerImages, setStickerImages] = useState([]);
            
            const canvasRef = useRef(null);
            const fileInputRef = useRef(null);
            const stickerInputRef = useRef(null);
            const fontInputRef = useRef(null);

            useEffect(() => {
                if (image) {
                    drawMeme();
                }
            }, [image, topText, bottomText, fontSize, fontFamily, uploadedFontName, outlineWidth, topTextPos, bottomTextPos, stickerImages]);

            const handleImageUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => setImage(img);
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleStickerUpload = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const img = new Image();
                        img.onload = () => {
                            setStickerImages([...stickerImages, { 
                                img, x: 0.5, y: 0.5, size: 0.2, id: Date.now() 
                            }]);
                        };
                        img.src = event.target.result;
                    };
                    reader.readAsDataURL(file);
                }
            };

            const handleFontUpload = (e) => {
                const file = e.target.files[0];
                if (file && (file.name.endsWith('.ttf') || file.name.endsWith('.otf') || file.name.endsWith('.woff') || file.name.endsWith('.woff2'))) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        const fontName = `CustomFont_${Date.now()}`;
                        const fontFace = new FontFace(fontName, `url(${event.target.result})`);
                        fontFace.load().then((loadedFont) => {
                            document.fonts.add(loadedFont);
                            setUploadedFontName(fontName);
                            alert(`Font "${file.name}" berhasil diupload!`);
                        }).catch(() => {
                            alert('Gagal load font. Pastikan file format benar.');
                        });
                    };
                    reader.readAsDataURL(file);
                } else {
                    alert('File harus format .ttf, .otf, .woff, atau .woff2');
                }
            };

            const drawMeme = () => {
                const canvas = canvasRef.current;
                if (!canvas || !image) return;
                const ctx = canvas.getContext('2d');

                const maxWidth = 800;
                const maxHeight = 800;
                let width = image.width;
                let height = image.height;

                if (width > maxWidth || height > maxHeight) {
                    const ratio = Math.min(maxWidth / width, maxHeight / height);
                    width *= ratio;
                    height *= ratio;
                }

                canvas.width = width;
                canvas.height = height;

                ctx.drawImage(image, 0, 0, width, height);

                stickerImages.forEach(sticker => {
                    if (sticker.img && sticker.img.complete) {
                        const stickerWidth = sticker.size * width;
                        const stickerHeight = (sticker.img.height / sticker.img.width) * stickerWidth;
                        const x = sticker.x * width - stickerWidth / 2;
                        const y = sticker.y * height - stickerHeight / 2;
                        ctx.drawImage(sticker.img, x, y, stickerWidth, stickerHeight);
                    }
                });

                const finalFont = uploadedFontName || fontFamily;
                ctx.fillStyle = 'white';
                ctx.strokeStyle = 'black';
                ctx.lineWidth = outlineWidth;
                ctx.textAlign = 'center';
                ctx.font = `bold ${fontSize}px ${finalFont}, Arial Black, sans-serif`;

                const wrapText = (text, maxWidth) => {
                    const words = text.split(' ');
                    const lines = [];
                    let currentLine = words[0];
                    for (let i = 1; i < words.length; i++) {
                        const word = words[i];
                        const width = ctx.measureText(currentLine + ' ' + word).width;
                        if (width < maxWidth) {
                            currentLine += ' ' + word;
                        } else {
                            lines.push(currentLine);
                            currentLine = word;
                        }
                    }
                    lines.push(currentLine);
                    return lines;
                };

                if (topText) {
                    const lines = wrapText(topText.toUpperCase(), width - 20);
                    const startY = topTextPos.y * height;
                    lines.forEach((line, index) => {
                        const y = startY + (index * fontSize * 1.1);
                        const x = topTextPos.x * width;
                        ctx.strokeText(line, x, y);
                        ctx.fillText(line, x, y);
                    });
                }

                if (bottomText) {
                    const lines = wrapText(bottomText.toUpperCase(), width - 20);
                    const startY = bottomTextPos.y * height;
                    lines.forEach((line, index) => {
                        const y = startY + (index * fontSize * 1.1);
                        const x = bottomTextPos.x * width;
                        ctx.strokeText(line, x, y);
                        ctx.fillText(line, x, y);
                    });
                }
            };

            const downloadMeme = () => {
                const canvas = canvasRef.current;
                if (!canvas) return;
                const link = document.createElement('a');
                link.download = 'meme.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
            };

            const resetMeme = () => {
                setImage(null);
                setTopText('');
                setBottomText('');
                setFontSize(48);
                setFontFamily('Impact');
                setUploadedFontName('');
                setOutlineWidth(3);
                setTopTextPos({ x: 0.5, y: 0.15 });
                setBottomTextPos({ x: 0.5, y: 0.85 });
                setStickerImages([]);
                if (fileInputRef.current) fileInputRef.current.value = '';
                if (stickerInputRef.current) stickerInputRef.current.value = '';
                if (fontInputRef.current) fontInputRef.current.value = '';
            };

            const handleMouseDown = (textType) => setDragging(textType);

            const handleMouseMove = (e) => {
                if (!dragging || !canvasRef.current) return;
                const canvas = canvasRef.current;
                const rect = canvas.getBoundingClientRect();
                const x = (e.clientX - rect.left) / rect.width;
                const y = (e.clientY - rect.top) / rect.height;

                if (dragging === 'top') {
                    setTopTextPos({ x: Math.max(0, Math.min(1, x)), y: Math.max(0, Math.min(1, y)) });
                } else if (dragging === 'bottom') {
                    setBottomTextPos({ x: Math.max(0, Math.min(1, x)), y: Math.max(0, Math.min(1, y)) });
                } else if (dragging.startsWith('sticker-')) {
                    const stickerId = parseInt(dragging.split('-')[1]);
                    setStickerImages(stickerImages.map(s => 
                        s.id === stickerId ? { ...s, x: Math.max(0, Math.min(1, x)), y: Math.max(0, Math.min(1, y)) } : s
                    ));
                }
            };

            const handleMouseUp = () => setDragging(null);

            const handleRiccoClick = () => {
                setRiccoClicks(prev => prev + 1);
                setIsAnimating(true);
                setTimeout(() => setIsAnimating(false), 500);
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-600 via-pink-500 to-red-500 p-4">
                    <div className="max-w-7xl mx-auto">
                        <div className="text-center mb-8">
                            <h1 className="text-6xl font-black text-white mb-2 drop-shadow-lg animate-pulse">
                                STICKER TEMPEL TEXT
                            </h1>
                            <p className="text-xl text-white font-bold drop-shadow-md">
                                INI BUAT TEMPEL TEXT YGY!
                            </p>
                        </div>

                        <div className="grid md:grid-cols-2 gap-6">
                            <div className="bg-white rounded-2xl shadow-2xl p-6 space-y-6">
                                <div className="bg-gradient-to-r from-blue-500 to-purple-600 rounded-xl p-4">
                                    <h2 className="text-2xl font-black text-white mb-4 flex items-center gap-2">
                                        <ImageIcon /> Tempel Sticker/Gambar
                                    </h2>
                                    <input
                                        ref={stickerInputRef}
                                        type="file"
                                        accept="image/*"
                                        onChange={handleStickerUpload}
                                        className="hidden"
                                    />
                                    <button
                                        onClick={() => stickerInputRef.current?.click()}
                                        className="w-full bg-white text-purple-600 px-6 py-3 rounded-lg font-bold hover:bg-purple-100 transition-all duration-300 hover:shadow-lg transform hover:scale-105"
                                    >
                                        + Tambah Sticker
                                    </button>
                                    {stickerImages.length > 0 && (
                                        <div className="mt-4 space-y-2">
                                            <p className="text-white font-bold">Sticker Aktif: {stickerImages.length}</p>
                                            <button
                                                onClick={() => setStickerImages([])}
                                                className="w-full bg-red-500 text-white px-4 py-2 rounded-lg font-bold hover:bg-red-600 transition-all duration-300"
                                            >
                                                Hapus Semua Sticker
                                            </button>
                                        </div>
                                    )}
                                </div>

                                <div className="bg-gradient-to-r from-green-500 to-teal-600 rounded-xl p-4">
                                    <h2 className="text-2xl font-black text-white mb-4 flex items-center gap-2">
                                        <Upload /> Upload Gambar
                                    </h2>
                                    <input
                                        ref={fileInputRef}
                                        type="file"
                                        accept="image/*"
                                        onChange={handleImageUpload}
                                        className="hidden"
                                    />
                                    <button
                                        onClick={() => fileInputRef.current?.click()}
                                        className="w-full bg-white text-green-600 px-6 py-3 rounded-lg font-bold hover:bg-green-100 transition-all duration-300 hover:shadow-lg transform hover:scale-105"
                                    >
                                        üìÅ Pilih Gambar
                                    </button>
                                </div>

                                <div className="bg-gradient-to-r from-orange-500 to-red-600 rounded-xl p-4">
                                    <h2 className="text-2xl font-black text-white mb-4 flex items-center gap-2">
                                        <Type /> TEXT
                                    </h2>
                                    <div className="space-y-4">
                                        <div>
                                            <label className="block text-white font-bold mb-2">Text Atas</label>
                                            <input
                                                type="text"
                                                value={topText}
                                                onChange={(e) => setTopText(e.target.value)}
                                                placeholder="TEXT ATAS"
                                                className="w-full px-4 py-3 border-2 border-white rounded-lg focus:border-yellow-300 focus:outline-none font-bold uppercase"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-white font-bold mb-2">Text Bawah</label>
                                            <input
                                                type="text"
                                                value={bottomText}
                                                onChange={(e) => setBottomText(e.target.value)}
                                                placeholder="TEXT BAWAH"
                                                className="w-full px-4 py-3 border-2 border-white rounded-lg focus:border-yellow-300 focus:outline-none font-bold uppercase"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-white font-bold mb-2">Pilih Font</label>
                                            <select
                                                value={fontFamily}
                                                onChange={(e) => setFontFamily(e.target.value)}
                                                disabled={uploadedFontName !== ''}
                                                className="w-full px-4 py-3 border-2 border-white rounded-lg focus:border-yellow-300 focus:outline-none font-bold disabled:bg-gray-300"
                                            >
                                                <option value="Impact">Impact</option>
                                                <option value="Arial Black">Arial Black</option>
                                                <option value="Comic Sans MS">Comic Sans MS</option>
                                                <option value="Courier New">Courier New</option>
                                            </select>
                                        </div>
                                        <div>
                                            <label className="block text-white font-bold mb-2">
                                                Upload Font Custom (.ttf, .otf, .woff)
                                            </label>
                                            <input
                                                ref={fontInputRef}
                                                type="file"
                                                accept=".ttf,.otf,.woff,.woff2"
                                                onChange={handleFontUpload}
                                                className="hidden"
                                            />
                                            <button
                                                onClick={() => fontInputRef.current?.click()}
                                                className="w-full bg-white text-orange-600 px-4 py-2 rounded-lg font-bold hover:bg-orange-100"
                                            >
                                                {uploadedFontName ? '‚úì Font Terupload' : 'üìÅ Pilih File Font'}
                                            </button>
                                        </div>
                                        <div>
                                            <label className="block text-white font-bold mb-2">
                                                Ukuran Font: {fontSize}px
                                            </label>
                                            <input
                                                type="range"
                                                min="20"
                                                max="100"
                                                value={fontSize}
                                                onChange={(e) => setFontSize(parseInt(e.target.value))}
                                                className="w-full"
                                            />
                                        </div>
                                        <div>
                                            <label className="block text-white font-bold mb-2">
                                                Ketebalan Outline: {outlineWidth}px
                                            </label>
                                            <input
                                                type="range"
                                                min="0"
                                                max="10"
                                                value={outlineWidth}
                                                onChange={(e) => setOutlineWidth(parseInt(e.target.value))}
                                                className="w-full"
                                            />
                                        </div>
                                    </div>
                                </div>

                                <div className="flex gap-4">
                                    <button
                                        onClick={downloadMeme}
                                        className="flex-1 bg-gradient-to-r from-green-500 to-emerald-600 text-white px-6 py-4 rounded-xl font-black text-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2"
                                    >
                                        <Download /> Download
                                    </button>
                                    <button
                                        onClick={resetMeme}
                                        className="flex-1 bg-gradient-to-r from-red-500 to-pink-600 text-white px-6 py-4 rounded-xl font-black text-lg hover:shadow-xl transform hover:scale-105 transition-all duration-300 flex items-center justify-center gap-2"
                                    >
                                        <Trash2 /> Reset
                                    </button>
                                </div>
                            </div>

                            <div className="bg-white rounded-2xl shadow-2xl p-6">
                                <h2 className="text-3xl font-black text-purple-600 mb-4 text-center">
                                    Preview Sticker
                                </h2>
                                {image ? (
                                    <div
                                        className="relative inline-block"
                                        onMouseMove={handleMouseMove}
                                        onMouseUp={handleMouseUp}
                                        onMouseLeave={handleMouseUp}
                                    >
                                        <canvas
                                            ref={canvasRef}
                                            className="max-w-full h-auto rounded-lg shadow-lg cursor-move border-4 border-purple-300"
                                            onMouseDown={(e) => {
                                                const canvas = canvasRef.current;
                                                const rect = canvas.getBoundingClientRect();
                                                const x = (e.clientX - rect.left) / rect.width;
                                                const y = (e.clientY - rect.top) / rect.height;

                                                for (let i = stickerImages.length - 1; i >= 0; i--) {
                                                    const sticker = stickerImages[i];
                                                    const stickerWidth = sticker.size;
                                                    const stickerHeight = sticker.size * (sticker.img.height / sticker.img.width);
                                                    const distX = Math.abs(x - sticker.x);
                                                    const distY = Math.abs(y - sticker.y);
                                                    if (distX < stickerWidth / 2 && distY < stickerHeight / 2) {
                                                        setDragging(`sticker-${sticker.id}`);
                                                        return;
                                                    }
                                                }

                                                const topDist = Math.sqrt(Math.pow(x - topTextPos.x, 2) + Math.pow(y - topTextPos.y, 2));
                                                const bottomDist = Math.sqrt(Math.pow(x - bottomTextPos.x, 2) + Math.pow(y - bottomTextPos.y, 2));

                                                if (topText && topDist < 0.1) {
                                                    handleMouseDown('top');
                                                } else if (bottomText && bottomDist < 0.1) {
                                                    handleMouseDown('bottom');
                                                }
                                            }}
                                        />
                                    </div>
                                ) : (
                                    <div className="bg-gradient-to-br from-purple-200 to-pink-200 rounded-lg p-12 text-center">
                                        <ImageIcon />
                                        <p className="text-2xl font-bold text-purple-600 mt-4">
                                            Upload Dulu Gambarnya wok
                                        </p>
                                    </div>
                                )}
                            </div>
                        </div>

                        <div className="text-center mt-8">
                            <button
                                onClick={handleRiccoClick}
                                className={`text-4xl font-black text-white drop-shadow-lg hover:scale-110 transition-transform duration-300 ${isAnimating ? 'animate-bounce' : ''}`}
                            >
                                {riccoClicks > 0 ? 'RIKKIUU' : 'RICCO;D'}
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        ReactDOM.render(<MemeMaker />, document.getElementById('root'));
    </script>
</body>
</html>
